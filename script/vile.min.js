function VileException(a,b){a=void 0===a?"Error occured":a;this.name=void 0===b?"VileException":b;this.message=a;this.level="Show Stopper";this.htmlMessage=a;this.toString=function(){return this.name+": "+this.message}}
var Vile={initialize:function(a){this.weave(a);a.e=this.VileEditor.makeEditor();a.f=this.Factory.makeFactory();a.template=this.weaveTemplate()},list_attr_previxes:["vile-weave"],validate_page_object:function(a,b){if("object"!==typeof a&&"undefined"!==typeof a)throw new VileException("Cannot "+(null!=b?b:"process")+" non-object and non-null");if(null===a||"undefined"==typeof a)a={};return a},isAlpha:function(a){return a.match(/[a-z]/i)},escape:function(a){var b=document.createElement("div");b.appendChild(document.createTextNode(a));
return b.innerHTML},unescape:function(a){var b=document.createElement("div");b.innerHTML=a;return(a=b.childNodes[0])?a.nodeValue:""},unescapeTemplate:function(a){return a.replace("&amp;","&").replace("&lt;","<").replace("&gt;",">").replace("&quot;",'"').replace("&#039;","'")},weave:function(a){a=this.validate_page_object(a,"weave");for(var b=document.querySelectorAll("*[vile-weave]"),c=0;c<b.length;c++){var e=b[c].getAttribute("vile-weave");0<e.length&&(a[e]=b[c])}return a},weaveJq:function(a){try{if("undefined"==
typeof $||!window.jQuery)throw"";a=this.validate_page_object(a,"weave");for(var b=document.querySelectorAll("*[vile-weave]"),c=0;c<b.length;c++){var e=b[c].getAttribute("vile-weave");0<e.length&&(a[e]=$(b[c]))}return a}catch(d){throw new VileException("JQuery is not loaded");}},weaveTemplate:function(a){a=this.validate_page_object(a,"weave templates");for(var b=document.querySelectorAll("template"),c=0;c<b.length;c++)if(b[c].hasAttribute("id")){var e=b[c].getAttribute("id");0<e.length&&(a[e]=b[c].innerHTML.trim())}return a},
VileEditor:{makeEditor:function(a){a=void 0===a?{}:a;var b={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},c=function(a){return"object"===typeof a&&null!==a},e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};a.esc=function(a){return String(a).replace(/[&<>"'\/]/g,function(a){return e[a]})};a.makeVoid=function(d,c){if(1!=b[d])return a.makeE(d,"",c);var f=a.generateAttributes(c);return"<"+
d+f+">"};a.makeE=function(d,c,f){if(1==b[d])return a.makeVoid(d,f);f=a.generateAttributes(f);return"<"+d+f+">"+c+"</"+d+">"};a.make=function(d,e,f){var h;if(c(e)&&"string"==typeof f)h=e,e=f;else if(c(f)&&"string"==typeof e)h=f;else throw new VileException("Invalid parameters. editor.make parameters should be element(string),content(string),attrib(object) or element(string),attrib(object),content(string)");return 1!=b[d]?a.makeE(d,e,h):a.makeVoid(d,h)};a.makeStyle=function(b,c){return b+"{"+a.generateAttributesForStyle(c)+
"}"};a.generateAttributesForStyle=function(a){var b="",c;for(c in a)b+=c+":"+a[c]+";";return b};a.generateAttributes=function(a){c(a)||(a={});var b="",f;for(f in a)b+=" "+f,!0!==a[f]&&(b+='="'+a[f]+'"');return b};return a}},ShadowCaster:function(){return{cast:function(a){return this.createShadowRoot()},custom:function(a){a=Vile.validate_page_object(a);var b=a.name.toLowerCase(),c=a.content,e=a.callback;a=a.method;if(!b.includes("-"))throw new VileException("ShadowCast needs name with '-' in it, such as 'foo-bar' or 'my-phone-number'");
if(!Vile.isAlpha(b[0])||!Vile.isAlpha(b[b.length-1]))throw new VileException("ShadowCast needs name must start and end with alphabetic character");"function"!=typeof c&&"string"!=typeof c&&(c=function(a){return a.innerHTML});e=Vile.validate_page_object(e);a=Vile.validate_page_object(a);var d=Object.create(HTMLElement.prototype),g;for(g in a)d[g]=a[g];d.shadow=function(a){if(null==a)return null==this.shadowElement&&(this.shadowElement=this.createShadowRoot()),this.shadowElement;"string"==typeof a&&
(null==this.shadowElement&&(this.shadowElement=this.createShadowRoot()),this.shadowElement.innerHTML=a)};d.refresh=function(){"function"==typeof c?this.innerHTML=c(this):"string"==typeof c&&(this.innerHTML=c)};"function"==typeof e.oncreate&&(d.createdCallback=e.oncreate);"function"==typeof e.onattach&&(d.attachedCallback=e.onattach);"function"==typeof e.ondetach&&(d.detachedCallback=e.ondetach);"function"==typeof e.onattributechange&&(d.attributeChangedCallback=e.onattributechange);d.attachedCallback||
(d.attachedCallback=d.refresh);d.createdCallback||(d.createdCallback=d.refresh);document.registerElement(b,{prototype:d})}}}(),Factory:{mold:function(a,b){function c(b){var c=a.indexOf("&lt;%=",b),d=a.indexOf("&lt;%-",b);b=!1;d<c&&0<=d&&(c=d,b=!0);var d=a.indexOf("%&gt;",c+6),e=a.indexOf("&lt;%=",c+6),g=a.indexOf("&lt;%-",c+6);g<e&&0<=g&&(e=g);d>e&&0<=e&&(d=-1);return{start:c,end:d,escape:b}}function e(c){var d=a.substr(c.start+6,c.end-1-(c.start+6)).trim(),e="";0!=d.length&&("undefined"!=typeof b[d]&&
(e=b[d]),c.escape&&(e=Vile.escape(e)));a=a.substr(0,c.start)+e+a.substr(c.end+5);return e}if("string"!==typeof a)throw new VileException("Template must be string");b=Vile.validate_page_object(b);for(var d=0;d<a.length;){var g=c(d);if(-1==g.start)break;else if(0<=g.start&&-1==g.end)throw new VileException("There's an error in the given template.");d=g.start;g=e(g);d+=g.length;d++}return a},moldMany:function(a,b){for(var c="",e=0;e<b.length;e++)c+=this.mold(a,b[e]);return c},moldArray:function(a,b){b=
[];for(var c=0;c<b.length;c++)b.push(this.mold(a,b[c]));return b},makeFactory:function(a){a=void 0===a?{}:a;for(var b in this)a[b]=this[b];return a}}};
